language: generic
services:
- docker
before_install:
- cd update-motd/
- git clone --single-branch --branch c7 https://git.centos.org/rpms/pam.git
script:
- docker pull gdubicki/centos-pam-with-update-motd
- docker run -it -v "$TRAVIS_BUILD_DIR/update-motd/bin/run-parts-debian:/root/rpmbuild/SOURCES/run-parts-debian"
  -v "$TRAVIS_BUILD_DIR/update-motd/pam.spec:/root/rpmbuild/SPECS/pam.spec" -v "$TRAVIS_BUILD_DIR/update-motd/pam-1.1.8-update-motd.patch:/root/rpmbuild/SOURCES/pam-1.1.8-update-motd.patch"
  -v "$TRAVIS_BUILD_DIR/update-motd/pam/SOURCES:/root/rpmbuild/SOURCES" -v "$TRAVIS_BUILD_DIR/update-motd/rpmbuild/RPMS:/root/rpmbuild/RPMS"
  gdubicki/centos-pam-with-update-motd:latest /bin/bash -c "spectool --get-files -C
  /root/rpmbuild/SOURCES/ /root/rpmbuild/SPECS/pam.spec ; rpmbuild --define '_topdir
  /root/rpmbuild' -bb /root/rpmbuild/SPECS/pam.spec"
deploy:
  provider: releases
  api_key:
    secure: "wYWXLIS9JZ0TE5dzvtG328l2bKDC6v4sAvZqf0H/IySClaK34qxxcX2viQskqbyyemeE9NndW42IvfreFFEC1MXbq3GnmGo4lZXglHzAFSdbQYAcYDBG8Xk/TJgvNQ5XLeFNO5zvD9OOp0jRihWLPDDKNaAzB6c7TH6q1/1VvXpodpvxTx+U3zAJ6VXJv8SlSXVKu7VeXmweQ7sSLxMTGfFdtDAW+XmO+afMZQPY0p/boK1MmBI8pLXQI5oX+IeJ2oFun/hFkS5f+aSdZAlnOW/plJrOX0KAlKEXYxckhdes7kZHjudoWopaNz3GDqq7fMlqvO2YWE9v/Xq9y2vD8twyv9u/Q7IjpVVskJiaEnVwxznYEAzXzJ9TBrBG2V3hFe8KhON7HIoBh7i5zCQG5uPMYqjo8gae4nonVsm5vNSJqIaHDR7hlfmS9sn7wAVoNajsl2G+/pZVAuFYH9SH2VXdFOwUpWQHjAlzlMNOeYaBr/QJMNNd5mncTiLQuDKizy0vhYuSyfp6RJ3MbwfMzEQc9WZsaA38CrNDdOC6ssOyWBtN76SawptYkAfL+23vMLDML2pIVC0+xr2msKf51M1zkf4hTS4Ew9huP6grbsIzs+IRRVad9uLuuRulOBQ/+FUCV+oPArrq9SQR4Ja1Lq3kzeURSlseIpDAuZOWUVM="
  file_glob: true
  file: update-motd/rpmbuild/RPMS/*.rpm
  skip_cleanup: true
  on:
    repo: gdubicki/centos-pam-with-update-motd
    tags: true
  draft: true
